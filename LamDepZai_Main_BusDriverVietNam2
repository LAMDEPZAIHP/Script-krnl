local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- 2. KHAI B√ÅO C√ÅC BI·∫æN LOCAL CH√çNH (MAIN VARIABLES)
local LocalPlayer = Players.LocalPlayer -- ƒê·ªïi t√™n th√†nh LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui") -- ƒê·ªïi t√™n th√†nh PlayerGui

-- ===== KEY SYSTEM (Gi·ªØ nguy√™n logic) =====
local validKeys = {
"Fh453", "Hf456", "LAMSTUDIO", "Lam3456", "LamDepZai",
"Dongfeng", "1995", "1998", "Hwtyeye7ud", "Truckofdie"
}

local MAX_ATTEMPTS = 5 -- ƒê·ªïi th√†nh h·∫±ng s·ªë (convention chuy√™n nghi·ªáp)
local attempts = 0
local keyAccepted = false
local locked = false

-- GUI Key System (ƒê·ªïi t√™n ƒë·ªÉ d·ªÖ qu·∫£n l√Ω)
local keyScreenGui = Instance.new("ScreenGui")
keyScreenGui.Name = "Bdvn2_KeySystemGui" -- Th√™m Bdvn2
keyScreenGui.Parent = PlayerGui

local frame = Instance.new("Frame", keyScreenGui)
frame.Size = UDim2.new(0, 400, 0, 180)
frame.Position = UDim2.new(0.5, -200, 0.5, -90)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "BDVN2 MAIN KEY SYSTEM" -- Th√™m Bdvn2 v√† Main
title.Font = Enum.Font.GothamBold
title.TextSize = 22
title.TextColor3 = Color3.fromRGB(255, 255, 255)

local textBox = Instance.new("TextBox", frame)
textBox.Size = UDim2.new(1, -40, 0, 50)
textBox.Position = UDim2.new(0, 20, 0, 60)
textBox.PlaceholderText = "Enter your key..."
textBox.TextColor3 = Color3.fromRGB(255,255,255)
textBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
textBox.ClearTextOnFocus = true
textBox.Font = Enum.Font.GothamBold
textBox.TextSize = 18
Instance.new("UICorner", textBox).CornerRadius = UDim.new(0, 8)

local submitButton = Instance.new("TextButton", frame)
submitButton.Size = UDim2.new(1, -40, 0, 40)
submitButton.Position = UDim2.new(0, 20, 0, 120)
submitButton.Text = "Submit Key"
submitButton.Font = Enum.Font.GothamBold
submitButton.TextSize = 18
submitButton.TextColor3 = Color3.fromRGB(255,255,255)
submitButton.BackgroundColor3 = Color3.fromRGB(80,80,80)
Instance.new("UICorner", submitButton).CornerRadius = UDim.new(0, 8)

local function lockScript()
    locked = true
    textBox.Text = ""
    textBox.PlaceholderText = "SCRIPT LOCKED!"
    textBox.TextColor3 = Color3.fromRGB(255,0,0)
    submitButton.Active = false
    submitButton.Text = "LOCKED"
    submitButton.BackgroundColor3 = Color3.fromRGB(100,0,0)
    warn("[BDVN2 MAIN] Script has been permanently locked due to too many invalid attempts.")
end

submitButton.MouseButton1Click:Connect(function()
    if keyAccepted or locked then return end
    local inputKey = textBox.Text
    if table.find(validKeys, inputKey) then
        keyAccepted = true
        keyScreenGui:Destroy()
        print("[BDVN2 MAIN] Key accepted! Main Script loading...") -- Th√™m Main
    else
        attempts = attempts + 1
        textBox.Text = ""
        textBox.PlaceholderText = "Invalid key! ("..attempts.."/"..MAX_ATTEMPTS..")"
        textBox.TextColor3 = Color3.fromRGB(255,0,0)
        if attempts >= MAX_ATTEMPTS then
            lockScript()
        end
    end
end)

-- Ch·ªù key ƒë∆∞·ª£c ch·∫•p nh·∫≠n tr∆∞·ªõc khi load ph·∫ßn c√≤n l·∫°i
repeat task.wait() until keyAccepted

-- LOADING MENU (Gi·ªØ nguy√™n logic)
local loadingGui = Instance.new("ScreenGui")
loadingGui.Name = "Bdvn2_MainLoadingGUI" -- Th√™m Bdvn2 v√† Main
loadingGui.ResetOnSpawn = false
loadingGui.Parent = PlayerGui

local frame = Instance.new("Frame", loadingGui)
frame.Size = UDim2.new(0, 300, 0, 80)
frame.Position = UDim2.new(0.5, -150, 0.5, -40)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BorderSizePixel = 0
frame.AnchorPoint = Vector2.new(0.5,0.5)
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

local label = Instance.new("TextLabel", frame)
label.Size = UDim2.new(1,0,1,0)
label.BackgroundTransparency = 1
label.TextColor3 = Color3.fromRGB(255,255,255)
label.Font = Enum.Font.GothamBold
label.TextSize = 22
label.Text = "Loading 0%"

for i = 1,100 do
    label.Text = "Loading "..i.."%"
    task.wait(0.03)
end

TweenService:Create(frame, TweenInfo.new(1), {BackgroundTransparency = 1}):Play()
TweenService:Create(label, TweenInfo.new(1), {TextTransparency = 1}):Play()
task.wait(1.2)
loadingGui:Destroy()


---

-- 3. GIAO DI·ªÜN CH√çNH (BDVN2 MAIN HUB)
local mainScreenGui = Instance.new("ScreenGui")
mainScreenGui.Name = "Bdvn2_MainHUB" -- Th√™m Bdvn2 v√† Main
mainScreenGui.ResetOnSpawn = false
mainScreenGui.Parent = PlayerGui

-- TH√äM ·∫¢NH N·ªÄN M·ªú V√ÄO SCREEN GUI
local backgroundBlurImage = Instance.new("ImageLabel")
backgroundBlurImage.Name = "BackgroundBlur"
backgroundBlurImage.Size = UDim2.new(1, 0, 1, 0)
backgroundBlurImage.BackgroundTransparency = 1
backgroundBlurImage.Image = "rbxassetid://136466594653671" -- ID ·∫¢nh c·ªßa b·∫°n
backgroundBlurImage.ImageTransparency = 0.5 -- ƒê·∫∑t ƒë·ªô trong su·ªët ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng m·ªù (blur)
backgroundBlurImage.ScaleType = Enum.ScaleType.Fit -- ƒê·∫£m b·∫£o ·∫£nh v·ª´a v·ªõi m√†n h√¨nh
backgroundBlurImage.ZIndex = 0 -- ƒê·∫∑t ZIndex th·∫•p ƒë·ªÉ n√≥ n·∫±m d∆∞·ªõi menu
backgroundBlurImage.Parent = mainScreenGui -- ƒê√£ ƒë·ªïi parent th√†nh mainScreenGui

-- T·∫†O KHUNG CH√çNH DUY NH·∫§T
local mainFrame = Instance.new("Frame")
mainFrame.Name = "Bdvn2_MainFrame" -- Th√™m Bdvn2 v√† Main
mainFrame.Size = UDim2.new(0, 520, 0, 320)
mainFrame.Position = UDim2.new(0.5, -260, 0.5, -160)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Parent = mainScreenGui
mainFrame.Active = true
mainFrame.Draggable = true
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 15)

-- Rainbow Title Border
local function makeRainbow(frame)
    local gradient = Instance.new("UIGradient", frame)
    gradient.Rotation = 90
    task.spawn(function()
        while task.wait(0.1) do
            local t = tick() % 6
            gradient.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.fromHSV((t/6),1,1)),
                ColorSequenceKeypoint.new(1, Color3.fromHSV(((t+1)/6)%1,1,1))
            }
        end
    end)
end
makeRainbow(mainFrame)

-- Title
local mainTitle = Instance.new("TextLabel", mainFrame)
mainTitle.Name = "MainTitle"
mainTitle.Size = UDim2.new(1, 0, 0, 35)
mainTitle.BackgroundTransparency = 1
mainTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
mainTitle.Text = "üáªüá≥Bdvn2 - Main Driver HUBüáªüá≥" -- TI√äU ƒê·ªÄ CH√çNH X√ÅC
mainTitle.Font = Enum.Font.GothamBold
mainTitle.TextSize = 22
mainTitle.Position = UDim2.new(0, 0, 0, 0)

-- Dev Info
local devInfo = Instance.new("TextLabel", mainFrame)
devInfo.Name = "DevInfo"
devInfo.Size = UDim2.new(1, 0, 0, 20)
devInfo.Position = UDim2.new(0, 0, 0, 30)
devInfo.BackgroundTransparency = 1
devInfo.TextColor3 = Color3.fromRGB(255, 255, 255)
devInfo.Font = Enum.Font.Gotham
devInfo.TextSize = 14
devInfo.Text = "Dev: L√¢m Mod (Bdvn2 Main Script)" -- Th√™m Bdvn2 Main

-- Flags
local mainFlag = Instance.new("TextLabel", mainFrame)
mainFlag.Size = UDim2.new(1, 0, 0, 20)
mainFlag.Position = UDim2.new(0, 0, 0, 50)
mainFlag.BackgroundTransparency = 1
mainFlag.TextColor3 = Color3.fromRGB(255, 255, 255)
mainFlag.Font = Enum.Font.GothamBold
mainFlag.TextSize = 16
mainFlag.Text = "T·ª± H√†o Vi·ªát Nam üáªüá≥"

-- Footer rainbow text
local function createFooter(parent)
    local footer = Instance.new("TextLabel", parent)
    footer.Size = UDim2.new(1, 0, 0, 22)
    footer.Position = UDim2.new(0, 0, 1, -25)
    footer.BackgroundTransparency = 1
    footer.Font = Enum.Font.GothamBold
    footer.TextSize = 16
    footer.Text = "T·ª± H√†o L√† Con Thi√™n Ch√∫a"
    footer.TextStrokeTransparency = 0.5
    task.spawn(function()
        local colors = {
            Color3.fromRGB(255,0,0), Color3.fromRGB(255,128,0), Color3.fromRGB(255,255,0),
            Color3.fromRGB(0,255,0), Color3.fromRGB(0,255,255), Color3.fromRGB(0,128,255), Color3.fromRGB(255,0,255)
        }
        local i = 1
        while true do
            footer.TextColor3 = colors[i]
            i = i % #colors + 1
            task.wait(0.4)
        end
    end)
end
createFooter(mainFrame)

-- Minimize button
local minimizeButton = Instance.new("TextButton", mainFrame)
minimizeButton.Size = UDim2.new(0, 25, 0, 25)
minimizeButton.Position = UDim2.new(1, -30, 0, 5)
minimizeButton.BackgroundColor3 = Color3.fromRGB(0, 50, 100)
minimizeButton.TextColor3 = Color3.new(1,1,1)
minimizeButton.Text = "-"
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.TextSize = 18
minimizeButton.BorderSizePixel = 0

local minimized = false
minimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    local targetSize = minimized and UDim2.new(0, 520, 0, 75) or UDim2.new(0, 520, 0, 320)
    TweenService:Create(mainFrame, TweenInfo.new(0.3), {Size = targetSize}):Play()
    for _, child in ipairs(mainFrame:GetChildren()) do
        if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("ScrollingFrame") or child:IsA("TextBox") or child:IsA("Frame") then
            if child ~= minimizeButton and child ~= mainTitle and child ~= devInfo and child.Name ~= "UIGradient" then -- Gi·ªØ l·∫°i Gradient
                child.Visible = not minimized
            end
        end
    end
end)


---

-- 4. C√ÅC T√çNH NƒÇNG CH√çNH (MAIN FEATURES)

-- LEFT MENU CONTENT (Scripts & Toggles)
local section1X = 20
local section1Y = 80

local function createScriptButton(parent, yOffset, text, url)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0, 230, 0, 30)
    btn.Position = UDim2.new(0, section1X, 0, section1Y + yOffset)
    btn.BackgroundColor3 = Color3.fromRGB(85, 85, 85)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Text = text
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.MouseButton1Click:Connect(function()
        if url == "KICK" then
            wait(5)
            LocalPlayer:Kick("[BDVN2 MAIN] B·∫°n ƒë√£ b·ªã c·∫•m vƒ©nh vi·ªÖn v√¨ s·ª≠ d·ª•ng t√≠nh nƒÉng Troll Kick.")
        else
            loadstring(game:HttpGet(url))()
        end
    end)
    return btn
end

local flyButton = createScriptButton(mainFrame, 0, "Fly GUI", "https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt")
local musicButton = createScriptButton(mainFrame, 40, "Music GUI", "https://raw.githubusercontent.com/Roblox-HttpSpy/my-Garbage/refs/heads/main/FeMusicExploit.lua")
local trollButton = createScriptButton(mainFrame, 80, "Troll Kick (Main)", "KICK") -- ƒê√£ ƒë·ªïi URL th√†nh KICK ƒë·ªÉ th·ª±c hi·ªán h√†m c·ª•c b·ªô
local killAllButton = createScriptButton(mainFrame, 120, "Bdvn2 Kill All (Main)", "TOGGLE_KILLALL") -- ƒê√£ ƒë·ªïi URL th√†nh TOGGLE_KILLALL
killAllButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)

local spiderButton = createScriptButton(mainFrame, 160, "Spider Script", "https://pastefy.app/wa3v2Vgm/raw")
local bangButton = createScriptButton(mainFrame, 200, "Bang GUI", "https://raw.githubusercontent.com/4gh9/Bang-Script-Gui/main/bang%20gui.lua")


-- Kill All (ƒê√£ g√≥i g·ªçn)
local killAllActive = false
local killAllGui = Instance.new("ScreenGui")
killAllGui.Name = "Bdvn2_KillAllGUI"
killAllGui.Parent = game.CoreGui
killAllGui.Enabled = false

local toggleKillAllButton = Instance.new("TextButton", killAllGui)
toggleKillAllButton.Size = UDim2.new(0, 100, 0, 50)
toggleKillAllButton.Position = UDim2.new(0.5, -50, 0.9, -30)
toggleKillAllButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toggleKillAllButton.Text = "KILL ALL OFF"
toggleKillAllButton.Font = Enum.Font.SourceSansBold
toggleKillAllButton.TextSize = 18
toggleKillAllButton.TextColor3 = Color3.fromRGB(255, 255, 255)

local function toggleKillAll()
    killAllActive = not killAllActive
    if killAllActive then
        toggleKillAllButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        toggleKillAllButton.Text = "KILL ALL ON"
        killAllGui.Enabled = true
    else
        toggleKillAllButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        toggleKillAllButton.Text = "KILL ALL OFF"
        killAllGui.Enabled = false
    end
end
toggleKillAllButton.MouseButton1Click:Connect(toggleKillAll)

-- G√°n ch·ª©c nƒÉng cho n√∫t trong Main Hub
killAllButton.MouseButton1Click:Connect(function()
    toggleKillAll()
end)

local function isFriendWith(p1, p2)
    return p1:IsFriendsWith(p2.UserId)
end

RunService.RenderStepped:Connect(function()
    if killAllActive then
        local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
        if tool and tool:FindFirstChild("Handle") then
            for _, otherPlayer in ipairs(Players:GetPlayers()) do
                if otherPlayer ~= LocalPlayer and not isFriendWith(LocalPlayer, otherPlayer) and otherPlayer.Character then
                    for _, part in next, otherPlayer.Character:GetChildren() do
                        if part:IsA("BasePart") then
                            firetouchinterest(tool.Handle, part, 0)
                            firetouchinterest(tool.Handle, part, 1)
                        end
                    end
                end
            end
        end
    end
end)


-- RIGHT MENU CONTENT (Player List & Toggles)
local section2X = 270
local section2Y = 80

local searchBox = Instance.new("TextBox", mainFrame)
searchBox.Size = UDim2.new(0, 230, 0, 24)
searchBox.Position = UDim2.new(0, section2X, 0, section2Y)
searchBox.PlaceholderText = "Search player..."
searchBox.Text = ""
searchBox.ClearTextOnFocus = false
searchBox.TextColor3 = Color3.fromRGB(240, 240, 240)
searchBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
searchBox.BorderSizePixel = 0
searchBox.Font = Enum.Font.Gotham
searchBox.TextSize = 14
Instance.new("UICorner", searchBox).CornerRadius = UDim.new(0, 10)

local listFrame = Instance.new("ScrollingFrame", mainFrame)
listFrame.Size = UDim2.new(0, 230, 0, 140)
listFrame.Position = UDim2.new(0, section2X, 0, section2Y + 30)
listFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
listFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
listFrame.BorderSizePixel = 0
listFrame.ScrollBarThickness = 8
listFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y

local UIListLayout = Instance.new("UIListLayout", listFrame)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0, 6)

local buttonFrame = Instance.new("Frame", mainFrame)
buttonFrame.Size = UDim2.new(0, 230, 0, 30)
buttonFrame.Position = UDim2.new(0, section2X, 0, section2Y + 180)
buttonFrame.BackgroundTransparency = 1
local UIList = Instance.new("UIListLayout", buttonFrame)
UIList.FillDirection = Enum.FillDirection.Horizontal
UIList.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIList.Padding = UDim.new(0, 10)

local function createToggleButton(name)
    local btn = Instance.new("TextButton")
    btn.Name = name.."Button"
    btn.Size = UDim2.new(0, 100, 0, 28)
    btn.BackgroundColor3 = Color3.fromRGB(85, 85, 85)
    btn.BorderSizePixel = 0
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Text = name..": OFF"
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.Parent = buttonFrame
    return btn
end

local noclipButton = createToggleButton("Noclip")
local espButton = createToggleButton("ESP")

-- Noclip (Main Toggle)
local noclip = false
noclipButton.MouseButton1Click:Connect(function()
    noclip = not noclip
    if noclip then
        noclipButton.Text = "Noclip: ON"
        noclipButton.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
    else
        noclipButton.Text = "Noclip: OFF"
        noclipButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
        if LocalPlayer.Character then
            for _,v in pairs(LocalPlayer.Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.CanCollide = true
                end
            end
        end
    end
end)

RunService.Stepped:Connect(function()
    if noclip and LocalPlayer.Character then
        for _,v in pairs(LocalPlayer.Character:GetDescendants()) do
            if v:IsA("BasePart") and v.CanCollide then
                v.CanCollide = false
            end
        end
    end
end)

-- ESP (Main Toggle)
local espEnabled = false
espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espButton.Text = espEnabled and "ESP: ON" or "ESP: OFF"
    espButton.BackgroundColor3 = espEnabled and Color3.fromRGB(0,200,0) or Color3.fromRGB(85,85,85)
    if espEnabled then
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Lucasfin000/SpaceHub/main/UESP"))()
    else
        warn("[BDVN2 MAIN] ESP SpaceHub kh√¥ng h·ªó tr·ª£ t·∫Øt, h√£y rejoin ƒë·ªÉ t·∫Øt ho√†n to√†n.")
    end
end)

-- Update player list (Bdvn2 Main Function)
local function UpdateBdvn2PlayerList() -- ƒê·ªïi t√™n h√†m
    for _, child in ipairs(listFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and string.find(plr.Name:lower(), searchBox.Text:lower()) then
            local btn = Instance.new("TextButton", listFrame)
            btn.Size = UDim2.new(1, 0, 0, 24)
            btn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
            btn.TextColor3 = Color3.new(1,1,1)
            btn.Text = "[TP] " .. plr.Name -- Th√™m [TP] cho chuy√™n nghi·ªáp
            btn.Font = Enum.Font.Gotham
            btn.TextSize = 14
            btn.MouseButton1Click:Connect(function()
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    LocalPlayer.Character:MoveTo(plr.Character.HumanoidRootPart.Position)
                    print("[BDVN2 MAIN] ƒê√£ Teleport t·ªõi " .. plr.Name)
                end
            end)
        end
    end
end

Players.PlayerAdded:Connect(UpdateBdvn2PlayerList)
Players.PlayerRemoving:Connect(UpdateBdvn2PlayerList)
searchBox:GetPropertyChangedSignal("Text"):Connect(UpdateBdvn2PlayerList)
UpdateBdvn2PlayerList()

-- Toggle menu hotkey
UserInputService.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == Enum.KeyCode.M then
        mainScreenGui.Enabled = not mainScreenGui.Enabled
    end
end)

print("---------------------------------------------")
print("  [BDVN2 MAIN] Main Utility HUB ƒë√£ s·∫µn s√†ng! ")
print("---------------------------------------------")
